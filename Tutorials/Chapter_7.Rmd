**Check Data Consistency**

Checking numeric consistency is critical because errors in numeric data often don’t trigger warnings in R. Mistakes like biologically impossible values, incorrect units, or data entry typos can silently affect your results and lead to incorrect conclusions. While outliers might signal a problem, they aren’t always wrong—and “normal-looking” values might still be invalid if they contradict other variables. Valid-checking between variables (e.g., body mass vs flipper length, or sex vs reproductive status).

**Basic range check**
A basic way to check data consistency is to examine the minimum and maximum values of each numeric column using summarise() with across(). This helps detect impossible or implausible values (e.g., negative numbers, extreme outliers, or unit errors). By reviewing these ranges, you can spot potential data entry mistakes that would otherwise go unnoticed because they don’t generate errors in R.

```{r}
## Basic range checks

# Check the min and max of all numeric columns
penguins_clean_names |> 
  summarise(across(where(is.numeric), 
                   list(min = ~min(., na.rm = TRUE),
                        max = ~max(., na.rm = TRUE))))

# Check the range of body mass only
penguins_clean_names |> 
  summarise(
    min_mass = min(body_mass_g, na.rm = TRUE),
    max_mass = max(body_mass_g, na.rm = TRUE)
  )
```
**Detecting impossible values**
Biologically impossible values, such as negative or zero body mass, should be checked and removed from the dataset. While NA is treated as missing, zero is considered a valid number, which can lead to incorrect statistical results. Negative values for measurements like mass or length are always invalid. These values often arise from data entry mistakes or placeholder values and must be identified using logical filters (e.g., filter(body_mass_g <= 0)) to ensure clean, accurate analysis.

```{r}
## Detecting biologically impossible values

# Check for any negative values in key measurement columns
penguins_clean_names |> 
  filter(if_any(c(body_mass_g, flipper_length_mm, 
                  culmen_length_mm, culmen_depth_mm), 
                ~ . < 0))

# Specifically check for 0 or negative body mass (impossible)
penguins_clean_names |> 
  filter(body_mass_g <= 0)

# Note: A value of 0 might represent a missing measurement that was wrongly entered instead of NA
```

**Species-specific checks**
Some values may be biologically plausible in general but implausible for a specific species. Checking numeric ranges by group (e.g., species) helps identify inconsistencies such as unusually large or small measurements. These could result from data entry errors, mislabelled species, incorrect units, or legitimate but rare biological variation. Outliers within species-specific expectations should be carefully reviewed rather than automatically removed.

```{r}
## Species-specific consistency checks

# Get body mass stats by species
penguins_clean_names |> 
  group_by(species) |> 
  summarise(
    min_mass = min(body_mass_g, na.rm = TRUE),
    max_mass = max(body_mass_g, na.rm = TRUE),
    mean_mass = mean(body_mass_g, na.rm = TRUE)
  )

# Find Adelie penguins with suspiciously large body mass
penguins_clean_names |> 
  filter(species == "Adelie Penguin (Pygoscelis adeliae)", body_mass_g > 4750)

# Use biological knowledge to assess:
# - Wrong measurement?
# - Wrong species?
# - Unit mix-up?
# - Rare but real large individual?
```

**Visual inspection and cross variable checks: expected correlations**

Visual and cross-variable checks are essential for spotting data inconsistencies that may not be obvious from numeric summaries alone. Boxplots and scatterplots help identify outliers, while plotting relationships between variables (e.g., body mass vs flipper length) reveals values that deviate from expected biological trends. Penguins with unusually large flippers but low body mass—or vice versa—may indicate errors, unit confusion, or mislabelled species. These checks require biological knowledge and judgment to distinguish between real variation and data issues.

```{r}
## Visual Inspection

# Plot body mass by species with outliers visible
penguins_clean_names |> 
  ggplot(aes(x = species, y = body_mass_g)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.3) +
  theme_minimal() +
  coord_flip()

## Cross-Variable Check

# Plot flipper length vs body mass by species
penguins_clean_names |> 
  ggplot(aes(x = flipper_length_mm, y = body_mass_g, color = species)) +
  geom_point(alpha = 0.6) +
  theme_minimal()

# Find penguins with large flippers but low mass
penguins_clean_names |> 
  filter(flipper_length_mm > 210, body_mass_g < 3500) |> 
  select(species, sex, flipper_length_mm, body_mass_g, island)

# Find penguins with small flippers but high mass
penguins_clean_names |> 
  filter(flipper_length_mm < 185, body_mass_g > 4500) |> 
  select(species, sex, flipper_length_mm, body_mass_g, island)
```

**Cross-variable checks: Biological impossibilities, spatial consistency, and flagging suspicious values**
In this stage of data cleaning, we check for biologically impossible combinations between variables. For example, a male penguin should not have an egg-laying date, and penguins should only appear on islands where their species is known to live. These are called cross-variable checks, and they help catch mistakes that aren’t obvious when looking at each column alone. We also create flags for values that are suspicious (like a Gentoo that’s too light or an Adelie that’s unusually heavy), instead of deleting them outright. This approach keeps the data biologically plausible and ready for robust analysis.

```{r}
## Biological impossibility checks

penguins_clean_names |> 
  filter(sex == "MALE", !is.na(date_egg))

## Spatial consistency checks

penguins_clean_names |> 
  count(species, island) |> 
  pivot_wider(names_from = island, values_from = n, values_fill = 0)

## Flag suspicious values

penguins_flagged <- penguins_clean_names |> 
  mutate(
    flag_impossible = case_when(
      body_mass_g <= 0 ~ "negative_or_zero_mass",
      flipper_length_mm <= 0 ~ "negative_or_zero_flipper",
      TRUE ~ NA_character_
    ),
    flag_implausible = case_when(
      body_mass_g < 2000 ~ "suspiciously_light",
      body_mass_g > 7000 ~ "suspiciously_heavy",
      TRUE ~ NA_character_
    ),
    flag_species_size = case_when(
      species == "Adelie Penguin (Pygoscelis adeliae)" & body_mass_g > 5000 ~ "Adelie_too_heavy",
      species == "Gentoo penguin (Pygoscelis papua)" & body_mass_g < 4000 ~ "Gentoo_too_light",
      TRUE ~ NA_character_
    ),
    any_flag = !is.na(flag_impossible) | !is.na(flag_implausible) | 
               !is.na(flag_species_size)
  )
```

